<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waste Classifier with Webcam</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        #video {
            width: 100%; /* Imposta la larghezza del video al 100% */
            max-width: 400px; /* Larghezza massima per la visualizzazione */
            border: 1px solid #ccc; /* Stile del bordo */
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div>
        <h1>Waste Classifier Sustainability App</h1>
        <button id="start-button">Start Camera</button>
        <video id="video" autoplay></video>
        <div id="waste-info"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script type="text/javascript">
        const URL = "https://teachablemachine.withgoogle.com/models/d5QK9Ebsp/";
        let model, maxPredictions;
        
        document.getElementById("start-button").addEventListener("click", async () => {
            // Carica il modello
            model = await tmImage.load(URL + "model.json", URL + "metadata.json");
            maxPredictions = model.getTotalClasses();

            // Imposta i constraints per la fotocamera posteriore
            const constraints = {
                video: {
                    facingMode: 'environment' // Usa la fotocamera posteriore
                }
            };

            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                document.getElementById("video").srcObject = stream;
                // Iniziare il riconoscimento dopo che il video è stato avviato
                setInterval(predict, 1000); // Predici ogni secondo
            } catch (error) {
                console.error("Errore nell'accesso alla fotocamera:", error);
                alert("Impossibile accedere alla fotocamera. Controlla i permessi.");
            }
        });

        async function predict() {
            const video = document.getElementById("video");
            const prediction = await model.predict(video);
            let highestProbability = 0;
            let mostLikelyClass = "";

            // Trova la classe con la probabilità più alta
            for (let i = 0; i < maxPredictions; i++) {
                const prob = prediction[i].probability.toFixed(2);
                const className = prediction[i].className;
                if (prob > highestProbability) {
                    highestProbability = prob;
                    mostLikelyClass = className;
                }
            }

            // Mostra i risultati
            const wasteInfoElement = document.getElementById("waste-info");
            wasteInfoElement.innerHTML = Classe: ${mostLikelyClass} (Probabilità: ${highestProbability * 100}%);
        }
    </script>
</body>
</html>
